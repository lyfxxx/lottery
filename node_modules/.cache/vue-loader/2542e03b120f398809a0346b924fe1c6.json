{"remainingRequest":"C:\\Users\\user\\lottery\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!C:\\Users\\user\\lottery\\src\\components\\lottery.vue?vue&type=template&id=5ce94202&scoped=true","dependencies":[{"path":"C:\\Users\\user\\lottery\\src\\components\\lottery.vue","mtime":1641793040421},{"path":"C:\\Users\\user\\lottery\\node_modules\\babel-loader\\lib\\index.js","mtime":1641444729683},{"path":"C:\\Users\\user\\lottery\\node_modules\\vue-loader-v16\\dist\\templateLoader.js","mtime":1641444731958},{"path":"C:\\Users\\user\\lottery\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1641444726897},{"path":"C:\\Users\\user\\lottery\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1641444730236}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CiAgPGRpdiBjbGFzcz0iYmdfcGFnZSI+CiAgICA8ZGl2PgogICAgICA8aW1nIDpzcmM9ImdyYWRlSW1nIiAvPgogICAgICA8ZGl2PgogICAgICAgIDwhLS0gPGRpdiB2LWlmPSJhd2FyZCI+5oq95Lite3sgYXdhcmQgfX08L2Rpdj4gLS0+CiAgICAgICAgPGltZyBzdHlsZT0id2lkdGg6IDEwMCUiIDpzcmM9ImF3YXJkSW1nIiAvPgogICAgICA8L2Rpdj4KICAgICAgPGRpdj4KICAgICAgICA8ZGl2IHYtZm9yPSIoaXRlbSwgaW5kZXgpIGluIHdvcmtlck5hbWUudmFsdWUiIDprZXk9ImluZGV4Ij4KICAgICAgICAgIHt7IGl0ZW0ubmFtZSB9fTvlkZjlt6Xlj7fvvJp7eyBpdGVtLnVpZCB9fQogICAgICAgIDwvZGl2PgogICAgICA8L2Rpdj4KICAgICAgPGRpdj4KICAgICAgICA8aW1nIHYtc2hvdz0iaXNTdG9wIiBzcmM9Ii4uL2Fzc2V0cy9zdGFydC5wbmciIEBjbGljaz0ic3RhcnRMb3R0ZXJ5IiAvPgogICAgICAgIDxpbWcgdi1zaG93PSIhaXNTdG9wIiBzcmM9Ii4uL2Fzc2V0cy9zdG9wLnBuZyIgQGNsaWNrPSJzdGFydExvdHRlcnkiIC8+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0ibW9kYWwiIHYtc2hvdz0ic2hvd01vZGFsIj48L2Rpdj4KICAgIDxkaXYgY2xhc3M9Im1vZGFsX2JnIiB2LXNob3c9InNob3dNb2RhbCIgQGNsaWNrPSJzaG93TW9kYWwgPSBmYWxzZSI+CiAgICAgIDxkaXY+CiAgICAgICAgPGRpdiB2LWZvcj0iKGl0ZW0sIGluZGV4KSBpbiB3b3JrZXJOYW1lLnZhbHVlIiA6a2V5PSJpbmRleCI+CiAgICAgICAgICB7eyBpdGVtLm5hbWUgfX075ZGY5bel5Y+377yae3sgaXRlbS51aWQgfX0KICAgICAgICA8L2Rpdj4KICAgICAgICA8aW1nIDpzcmM9ImF3YXJkSW1nIiAvPgogICAgICAgIDxkaXY+e3sgYXdhcmRMaXN0LnZhbHVlW2ldPy5uYW1lIHx8ICIiIH19PC9kaXY+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+CiAgICA8IS0tIDxkaXY+CiAgICAgIHt7IGF3YXJkTGlzdC52YWx1ZVtpXT8uZ3JhZGUgfX3nrYnlpZblk4HvvJp7eyBhd2FyZExpc3QudmFsdWVbaV0/Lm5hbWUgfX0KICAgIDwvZGl2PiAtLT4KICAgIDwhLS0gPGRpdiB2LWZvcj0iKGl0ZW0sIGluZGV4KSBpbiB3b3JrZXJOYW1lLnZhbHVlIiA6a2V5PSJpbmRleCI+CiAgICAgIOWnk+WQje+8mnt7IGl0ZW0ubmFtZSB9fTvlkZjlt6Xlj7fvvJp7eyBpdGVtLnVpZCB9fQogICAgPC9kaXY+IC0tPgoKICAgIDxkaXY+PC9kaXY+CiAgICA8IS0tIAogICAgPGJ1dHRvbiBAY2xpY2s9InN0YXJ0TG90dGVyeSI+e3sgYnV0dG9uTmFtZSB9fTwvYnV0dG9uPgogICAgPGJ1dHRvbiBAY2xpY2s9ImRvd25sb2FkRXhjZWwiPuS4i+i9vWV4Y2VsPC9idXR0b24+IC0tPgogICAgPGJ1dHRvbgogICAgICBAY2xpY2s9ImNsZWFuQXdhcmQiCiAgICAgIHYtaWY9ImkgPD0gMCB8fCBhd2FyZExpc3QudmFsdWVbYXdhcmRMaXN0LnZhbHVlLmxlbmd0aCAtIDFdPy5udW0gIT09IDAiCiAgICA+CiAgICAgIOa4heepuuWlluaxoAogICAgPC9idXR0b24+CiAgPC9kaXY+Cg=="},{"version":3,"sources":["C:\\Users\\user\\lottery\\src\\components\\lottery.vue"],"names":[],"mappings":";EASE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAClB,CAAC,CAAC,CAAC,CAAC;MACF,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;MACtB,CAAC,CAAC,CAAC,CAAC;QACF,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;MAC5C,CAAC,CAAC,CAAC,CAAC,CAAC;MACL,CAAC,CAAC,CAAC,CAAC;QACF,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;UACzD,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;QACnC,CAAC,CAAC,CAAC,CAAC,CAAC;MACP,CAAC,CAAC,CAAC,CAAC,CAAC;MACL,CAAC,CAAC,CAAC,CAAC;QACF,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;QACtE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;MACxE,CAAC,CAAC,CAAC,CAAC,CAAC;IACP,CAAC,CAAC,CAAC,CAAC,CAAC;;IAEL,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAC3C,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC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","file":"C:/Users/user/lottery/src/components/lottery.vue","sourceRoot":"","sourcesContent":["<!--\n * @Author: your name\n * @Date: 2021-12-27 18:22:02\n * @LastEditTime: 2022-01-10 10:53:26\n * @LastEditors: Please set LastEditors\n * @Description: 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE\n * @FilePath: \\lottery\\src\\components\\HelloWorld.vue\n-->\n<template>\n  <div class=\"bg_page\">\n    <div>\n      <img :src=\"gradeImg\" />\n      <div>\n        <!-- <div v-if=\"award\">抽中{{ award }}</div> -->\n        <img style=\"width: 100%\" :src=\"awardImg\" />\n      </div>\n      <div>\n        <div v-for=\"(item, index) in workerName.value\" :key=\"index\">\n          {{ item.name }};员工号：{{ item.uid }}\n        </div>\n      </div>\n      <div>\n        <img v-show=\"isStop\" src=\"../assets/start.png\" @click=\"startLottery\" />\n        <img v-show=\"!isStop\" src=\"../assets/stop.png\" @click=\"startLottery\" />\n      </div>\n    </div>\n\n    <div class=\"modal\" v-show=\"showModal\"></div>\n    <div class=\"modal_bg\" v-show=\"showModal\" @click=\"showModal = false\">\n      <div>\n        <div v-for=\"(item, index) in workerName.value\" :key=\"index\">\n          {{ item.name }};员工号：{{ item.uid }}\n        </div>\n        <img :src=\"awardImg\" />\n        <div>{{ awardList.value[i]?.name || \"\" }}</div>\n      </div>\n    </div>\n    <!-- <div>\n      {{ awardList.value[i]?.grade }}等奖品：{{ awardList.value[i]?.name }}\n    </div> -->\n    <!-- <div v-for=\"(item, index) in workerName.value\" :key=\"index\">\n      姓名：{{ item.name }};员工号：{{ item.uid }}\n    </div> -->\n\n    <div></div>\n    <!-- \n    <button @click=\"startLottery\">{{ buttonName }}</button>\n    <button @click=\"downloadExcel\">下载excel</button> -->\n    <button\n      @click=\"cleanAward\"\n      v-if=\"i <= 0 || awardList.value[awardList.value.length - 1]?.num !== 0\"\n    >\n      清空奖池\n    </button>\n  </div>\n</template>\n\n<script>\nimport { defineComponent, reactive, ref } from \"vue\";\nimport moment from \"moment\";\nimport Excel from \"exceljs/dist/exceljs\";\n\nlet db = null;\nexport default defineComponent({\n  setup() {\n    let showModal = ref(false);\n    let awardList = reactive({\n      value: [],\n    });\n    let gradeLists = reactive({\n      value: { 3: \"一\", 5: \"二\", 10: \"三\", 15: \"四\" },\n    });\n    let workerList = reactive({\n      value: [],\n    });\n    let workerName = reactive({ value: [] });\n    let award = ref(\"\");\n    let workerId = ref([]);\n    let i = ref(20);\n    let interval = reactive({ value: null });\n\n    let isStop = ref(true);\n    let lotteryList = reactive({\n      value: [],\n    });\n    let gradeList = ref([\"一\", \"二\", \"三\", \"四\", \"五\"]);\n    let getData = ({ tableName }) => {\n      lotteryList.value = [];\n      if (tableName === \"Awards\") {\n        return new Promise((resolve, reject) => {\n          let search = db\n            .transaction([tableName], \"readwrite\")\n            .objectStore(tableName);\n          let request = search.openCursor();\n          request.onerror = function () {\n            console.log(\"失败\");\n            reject();\n          };\n          request.onsuccess = function (e) {\n            var cursor = e.target.result;\n            console.log(\"成功\");\n            if (cursor) {\n              //console.log(cursor.value, 8888);\n              lotteryList.value.push(cursor.value);\n              cursor.continue();\n            } else {\n              if (lotteryList[i.value].num == 0) {\n                i.value = i.value + 1;\n              }\n              resolve();\n            }\n          };\n        });\n      }\n\n      // console.log(999);\n    };\n    function cleanAward() {\n      let store = db.transaction([\"Users\"], \"readwrite\").objectStore(\"Users\");\n      store.clear();\n      history.go(0);\n    }\n    async function downloadExcel() {\n      let a = [];\n      try {\n        const request = db\n          .transaction([\"Users\"], \"readwrite\")\n          .objectStore(\"Users\")\n          .openCursor();\n        request.onsuccess = function (e) {\n          let result = e.target.result;\n\n          if (result) {\n            a.push(result.value);\n            result.continue();\n          } else {\n            var jsonData = a;\n            //列标题，逗号隔开，每一个逗号就是隔开一个单元格\n            let str = `员工id,姓名,等级,奖项,时间\\n`;\n            //增加\\t为了不让表格显示科学计数法或者其他格式\n            for (let i = 0; i < jsonData.length; i++) {\n              for (let item in jsonData[i]) {\n                str += `${jsonData[i][item] + \"\\t\"},`;\n              }\n              str += \"\\n\";\n            }\n            //encodeURIComponent解决中文乱码\n            let uri =\n              \"data:text/xlsx;charset=utf-8,\\ufeff\" + encodeURIComponent(str);\n            //通过创建a标签实现\n            var link = document.createElement(\"a\");\n            link.href = uri;\n            //对下载的文件命名\n            link.download = \"2022年会中奖名单.xls\";\n            document.body.appendChild(link);\n            link.click();\n            document.body.removeChild(link);\n          }\n        };\n      } catch (error) {\n        console.log(error);\n      }\n    }\n\n    function writeDataBase({ tableName, id }) {\n      //奖池减一，人数获一\n      //获奖人不再参与下次抽奖？\n      let stores = db\n        .transaction([tableName], \"readwrite\")\n        .objectStore(tableName);\n      let request = stores.put({ id });\n      request.onsuccess = function (e) {\n        console.log(e);\n      };\n    }\n    function startLottery() {\n      // workerList.value = workerList.value.filter((item) => item.num === 0);\n      //let length = [...workerList.value].length;\n      //console.log(88800, aR.value.get(1));\n      if (this.i < 0) {\n        return;\n      }\n      let stopLottery = () => {\n        if (interval.value) {\n          //写操作\n          //员工id员工num\n          //奖品id奖品num\n          //是否进行下一等级抽奖\n\n          clearInterval(interval.value);\n          let saveData = (ind) => {\n            try {\n              let bR = null;\n              if (!bR) {\n                bR = db\n                  .transaction([\"Users\"], \"readwrite\")\n                  .objectStore(\"Users\");\n              }\n\n              bR.add({\n                id: workerName.value[ind].id,\n                name: workerName.value[ind].name,\n                grade: awardList.value[i.value].grade,\n                award: awardList.value[i.value].name,\n                time: moment().format(\"YYYY-MM-DD HH:mm:ss\"),\n                img: awardList.value[i.value].img,\n              });\n            } catch (error) {\n              console.log(888, error);\n            }\n          };\n          if (i.value >= 13) {\n            saveData(0);\n            saveData(1);\n          } else {\n            saveData(0);\n          }\n          workerList.value = workerList.value.filter((item) => {\n            if (i.value >= 13) {\n              return (\n                workerName.value[0].id !== item.id &&\n                workerName.value[1].id !== item.id\n              );\n            } else {\n              return workerName.value[0].id !== item.id;\n            }\n          });\n\n          i.value >= 0 && (award.value = awardList.value[i.value].name);\n\n          //console.log(22, workerList.value);\n          //let a = [...workerList.value];\n\n          // console.log(22, workerList.value);\n          //writeDataBase()\n\n          interval.value = null;\n        }\n      };\n      isStop.value = !isStop.value;\n      if (i.value == 0) {\n        if (interval.value) {\n          stopLottery();\n          clearInterval(interval.value);\n        }\n\n        return;\n      }\n      //   awardList.forEach((item) => {\n      //     if(){}\n      //   });\n\n      let index = 0;\n      // awardList.forEach(item=>{\n\n      // })\n      console.log(888888, isStop.value, i.value);\n      if (!isStop.value) {\n        if (awardList.value[awardList.value.length - 1]?.num == 0) {\n          if (i.value > 0) {\n            i.value = i.value - 1;\n          } else {\n            i.value = 0;\n          }\n        }\n        if (awardList.value[i.value].num > 0) {\n          awardList.value[i.value].num = 0;\n        }\n\n        award.value = \"\";\n        // if (i.value < 0) {\n        // }\n        //读操作\n        //员工表\n        //await getData({ tableName: \"Awards\" });\n        interval.value = setInterval(() => {\n          if (index < workerList.value.length) {\n            if (i.value >= 13) {\n              workerName.value = [\n                {\n                  name: workerList.value[index].name,\n                  id: workerList.value[index].id,\n                  uid: workerList.value[index].uid,\n                },\n                {\n                  name: workerList.value[\n                    index < workerList.value.length - 1 ? index + 1 : 0\n                  ].name,\n                  id: workerList.value[\n                    index < workerList.value.length - 1 ? index + 1 : 0\n                  ].id,\n                  uid: workerList.value[\n                    index < workerList.value.length - 1 ? index + 1 : 0\n                  ].uid,\n                },\n              ];\n            } else {\n              workerName.value = [\n                {\n                  name: workerList.value[index].name,\n                  id: workerList.value[index].id,\n                  uid: workerList.value[index].uid,\n                },\n              ];\n\n              //workerId.value = [workerList.value[index].id];\n            }\n\n            index++;\n          } else {\n            index = 0;\n          }\n        }, 100);\n        //   timeout = setTimeout(() => {\n\n        //     console.log(89000);\n        //   }, Infinity);\n      }\n      if (isStop.value) {\n        //写入\n        stopLottery();\n      }\n    }\n    const request = indexedDB.open(\"user\", 10);\n    request.onerror = function (e) {\n      // 错误处理\n      console.log(\" 打开数据库报错\", e);\n    };\n\n    request.onupgradeneeded = function (e) {\n      console.log(99999999999999);\n      e.target.result && (db = e.target.result);\n      //db = e.target.result;\n      if (!db.objectStoreNames.contains(\"Users\")) {\n        var a = db.createObjectStore(\"Users\", {\n          keyPath: \"id\",\n        });\n        a.createIndex(\"name\", \"name\", {\n          unique: false,\n        });\n      }\n\n      //   if (!db.objectStoreNames.contains(\"Users\")) {\n\n      //   }\n      if (!db.objectStoreNames.contains(\"Awards\")) {\n        var d = db.createObjectStore(\"Awards\", {\n          keyPath: \"id\",\n        });\n        d.createIndex(\"name\", \"name\", {\n          unique: false,\n        });\n      }\n    };\n    request.onsuccess = function (e) {\n      e.target.result && (db = e.target.result);\n      // var obj1 = { hello: \"world\" };\n      //var blob = new Blob([JSON.stringify(obj1, null, 2)], {\n      //  type: \"application/json\",\n      // });\n\n      let aR = db.transaction([\"Awards\"], \"readwrite\").objectStore(\"Awards\");\n      [\n        { name: \"iphone12\", num: 1 },\n        { name: \"小米电视\", num: 3 },\n        { name: \"不沾锅\", num: 5 },\n        { name: \"电吹风\", num: 8 },\n        { name: \"日记本\", num: 12 },\n      ].forEach((element, index) => {\n        aR.add({\n          id: index + 1,\n          name: element.name,\n          image: \"XXX\",\n          num: element.num,\n        });\n      });\n\n      //   aR.addEventListener(\"success\", (e) => {\n      //     console.log(12333, e);\n      //   });\n    };\n    //查询\n    let img = \"\";\n    return {\n      awardList,\n      lotteryList,\n      startLottery,\n      gradeLists,\n      isStop,\n      workerList,\n      workerName,\n      award,\n      i,\n      interval,\n      workerId,\n      gradeList,\n      getData,\n      writeDataBase,\n      downloadExcel,\n      cleanAward,\n      showModal,\n      img,\n    };\n\n    // var a = window.openDatabase(\"mydb\", \"1.0\", \"Test DB\", 2 * 1024 * 1024);\n    // console.log(9900, a);\n  },\n  watch: {\n    isStop(val) {\n      this.showModal = val;\n    },\n  },\n  computed: {\n    gradeImg() {\n      if (\n        this.awardList.value.length > 0 &&\n        this.awardList.value[this.i].grade\n      ) {\n        switch (this.awardList.value[this.i].grade) {\n          case \"五等奖\":\n            return require(\"../assets/award5.png\");\n          case \"四等奖\":\n            return require(\"../assets/award4.png\");\n          case \"三等奖\":\n            return require(\"../assets/award3.png\");\n          case \"二等奖\":\n            return require(\"../assets/award2.png\");\n          case \"一等奖\":\n            return require(\"../assets/award1.png\");\n        }\n      }\n      return \"\";\n    },\n    buttonName() {\n      if (this.i == 0) {\n        return !this.isStop ? \"停止抽一等奖 \" : \"本次抽奖已结束\";\n      } else {\n        return this.isStop\n          ? `开始抽${\n              this.awardList.value[this.i]?.nextGrade ||\n              this.awardList.value[this.i]?.grade\n            }等奖`\n          : \"停止抽奖\";\n      }\n    },\n    awardImg() {\n      // console.log(123456, this.awardList.value[this.i]?.img);\n      if (this.awardList.value.length > 0 && this.awardList.value[this.i].img) {\n        // if (this.i < 1) {\n        //   this.i = 1;\n        // }\n        return require(\"../assets/\" +\n          this.awardList.value[this.i < 0 ? 0 : this.i].img +\n          \".jpg\");\n      }\n      return \"\";\n    },\n  },\n  mounted() {\n    // console.log(workbook);\n\n    // const d = await workbook.xlsx.load(require(\"../assets/name_list.xlsx\"));\n    //console.log(8899, d);\n    //workbook.xlsx.readFile(\"../assets/name_list.xlsx\");\n    // const response = await fetch(\"./name_list.xlsx\");\n    // const buffer = await response.arrayBuffer();\n    // const options = {\n    //   sharedStrings: \"emit\",\n    //   hyperlinks: \"emit\",\n    //   worksheets: \"emit\",\n    // };\n    let workerList = [];\n    const workbook = new Excel.Workbook();\n    const setWorkerList = (aList) => {\n      this.workerList.value = aList;\n    };\n\n    const setAwardList = (aList) => {\n      console.log(888, aList);\n      this.awardList.value = aList;\n    };\n    let gradeLists = this.gradeLists.value;\n    // const workbook = ExcelJS.stream.xlsx.WorkbookReader(\n    //   \"./namelist.xlsx\",\n    //   options\n    // );\n    //workbook.read();\n    fetch(\"./namelist.xlsx\", {\n      responseType: \"arrayBuffer\",\n    })\n      .then((res) => {\n        return res.arrayBuffer();\n      })\n      .then(async (buffer) => {\n        workbook.xlsx.load(buffer).then(async (d) => {\n          const worksheet = d.getWorksheet(1);\n          //const a = await worksheet.parse();\n          worksheet.eachRow(function (row, rowNumber) {\n            if (rowNumber > 1) {\n              workerList.push({\n                id: rowNumber,\n                uid: row.values[2],\n                name: row.values[3],\n                num: 0,\n              });\n            }\n\n            // console.log(\n            //   \"Row \" + rowNumber + \" = \" + JSON.stringify(row.values)\n            // );\n          });\n        });\n        setWorkerList(workerList);\n      });\n    let awardList = [];\n    fetch(\"./award_list.xlsx\", {\n      responseType: \"arrayBuffer\",\n    })\n      .then((res) => {\n        return res.arrayBuffer();\n      })\n      .then(async (buffer) => {\n        workbook.xlsx.load(buffer).then(async (d) => {\n          const worksheet = d.getWorksheet(1);\n          //const a = await worksheet.parse();\n          worksheet.eachRow(function (row, rowNumber) {\n            console.log(123, row.values[5]);\n            if (rowNumber > 1) {\n              gradeLists[rowNumber]\n                ? awardList.push({\n                    name: row.values[3],\n                    num: row.values[4],\n                    grade: row.values[2],\n                    nextGrade: gradeLists[rowNumber],\n                    img: row.values[5] + \"\",\n                  })\n                : awardList.push({\n                    name: row.values[3],\n                    num: row.values[4],\n                    grade: row.values[2],\n                    img: row.values[5],\n                  });\n            }\n            // awardList.push({\n            //   id: rowNumber,\n            //   uid: row.values[2],\n            //   name: row.values[3],\n            //   num: 0,\n            // });\n            // console.log(\n            //   \"Row \" + rowNumber + \" = \" + JSON.stringify(row.values)\n            // );\n          });\n          setAwardList(awardList);\n        });\n        setAwardList(workerList);\n      });\n  },\n});\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style lang=\"less\" scoped>\nh3 {\n  margin: 40px 0 0;\n}\nul {\n  list-style-type: none;\n  padding: 0;\n}\nli {\n  display: inline-block;\n  margin: 0 10px;\n}\na {\n  color: #42b983;\n}\n.modal_bg {\n  background-image: url(\"../assets/lotterry_modal.png\");\n  background-repeat: no-repeat;\n  height: 45.3vw;\n  position: fixed;\n  z-index: 1000;\n  width: 38.3vw;\n  background-size: 100%;\n  background-position-y: 5vw;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  & > div {\n    margin-top: 7.5vw;\n    color: #ffda43;\n    font-size: 20px;\n    & > :last-child {\n      color: white;\n      margin-top: 15px;\n      font-size: 16px;\n    }\n  }\n  & img {\n    height: 12vw;\n    display: block;\n    line-height: 0;\n    margin-top: 15px;\n  }\n}\n.modal {\n  position: fixed;\n  top: 0;\n  z-index: 500;\n  width: 100vw;\n  height: 100vh;\n  background-color: rgba(0, 0, 0, 0.8);\n}\n.bg_page {\n  top: 0;\n  margin: 0;\n  padding: 0;\n  background-image: url(\"../assets/BG.png\");\n  background-size: 100% 100%;\n  height: 100vh;\n  width: 100vw;\n  overflow: hidden;\n  display: block;\n  clear: both;\n  & > :nth-child(1) {\n    position: absolute;\n    left: 50%;\n    transform: translateX(-50%);\n    bottom: 0;\n    & > :nth-child(2) {\n      width: 20vw;\n      height: 20vw;\n      margin: 0 auto;\n      background-image: url(\"../assets/award_area.png\");\n      background-size: 100% 100%;\n      display: flex;\n    }\n    & > :nth-child(3) {\n      background-image: url(\"../assets/name_BG.png\");\n      vertical-align: middle;\n      margin-bottom: 1.5vw;\n      margin-top: 0.8vw;\n      height: 2.8vw;\n      color: #ffda43;\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n    }\n    & > :nth-child(4) {\n      & > img {\n        width: 35vw;\n        display: block;\n        line-height: 0;\n      }\n    }\n  }\n}\n</style>\n"]}]}