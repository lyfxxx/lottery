{"remainingRequest":"C:\\Users\\user\\lottery\\node_modules\\thread-loader\\dist\\cjs.js!C:\\Users\\user\\lottery\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\user\\lottery\\node_modules\\vue-loader-v16\\dist\\templateLoader.js??ref--6!C:\\Users\\user\\lottery\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!C:\\Users\\user\\lottery\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!C:\\Users\\user\\lottery\\src\\components\\lottery.vue?vue&type=template&id=94833444&scoped=true","dependencies":[{"path":"C:\\Users\\user\\lottery\\src\\components\\lottery.vue","mtime":1641784885877},{"path":"C:\\Users\\user\\lottery\\babel.config.js","mtime":1640600522250},{"path":"C:\\Users\\user\\lottery\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1641444726897},{"path":"C:\\Users\\user\\lottery\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1641444726896},{"path":"C:\\Users\\user\\lottery\\node_modules\\babel-loader\\lib\\index.js","mtime":1641444729683},{"path":"C:\\Users\\user\\lottery\\node_modules\\vue-loader-v16\\dist\\templateLoader.js","mtime":1641444731958},{"path":"C:\\Users\\user\\lottery\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1641444726897},{"path":"C:\\Users\\user\\lottery\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1641444730236}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZS5qcyI7CmltcG9ydCB7IHRvRGlzcGxheVN0cmluZyBhcyBfdG9EaXNwbGF5U3RyaW5nLCBjcmVhdGVFbGVtZW50Vk5vZGUgYXMgX2NyZWF0ZUVsZW1lbnRWTm9kZSwgcmVuZGVyTGlzdCBhcyBfcmVuZGVyTGlzdCwgRnJhZ21lbnQgYXMgX0ZyYWdtZW50LCBvcGVuQmxvY2sgYXMgX29wZW5CbG9jaywgY3JlYXRlRWxlbWVudEJsb2NrIGFzIF9jcmVhdGVFbGVtZW50QmxvY2ssIHZTaG93IGFzIF92U2hvdywgd2l0aERpcmVjdGl2ZXMgYXMgX3dpdGhEaXJlY3RpdmVzLCBjcmVhdGVDb21tZW50Vk5vZGUgYXMgX2NyZWF0ZUNvbW1lbnRWTm9kZSwgcHVzaFNjb3BlSWQgYXMgX3B1c2hTY29wZUlkLCBwb3BTY29wZUlkIGFzIF9wb3BTY29wZUlkIH0gZnJvbSAidnVlIjsKaW1wb3J0IF9pbXBvcnRzXzAgZnJvbSAnLi4vYXNzZXRzL3N0YXJ0LnBuZyc7Cgp2YXIgX3dpdGhTY29wZUlkID0gZnVuY3Rpb24gX3dpdGhTY29wZUlkKG4pIHsKICByZXR1cm4gX3B1c2hTY29wZUlkKCJkYXRhLXYtOTQ4MzM0NDQiKSwgbiA9IG4oKSwgX3BvcFNjb3BlSWQoKSwgbjsKfTsKCnZhciBfaG9pc3RlZF8xID0gewogIGNsYXNzOiAiYmdfcGFnZSIKfTsKdmFyIF9ob2lzdGVkXzIgPSBbInNyYyJdOwoKdmFyIF9ob2lzdGVkXzMgPSAvKiNfX1BVUkVfXyovX3dpdGhTY29wZUlkKGZ1bmN0aW9uICgpIHsKICByZXR1cm4gLyojX19QVVJFX18qL19jcmVhdGVFbGVtZW50Vk5vZGUoImltZyIsIHsKICAgIHNyYzogX2ltcG9ydHNfMAogIH0sIG51bGwsIC0xKTsKfSk7Cgp2YXIgX2hvaXN0ZWRfNCA9IHsKICBjbGFzczogIm1vZGFsIgp9Owp2YXIgX2hvaXN0ZWRfNSA9IHsKICBjbGFzczogIm1vZGFsX2JnIgp9OwoKdmFyIF9ob2lzdGVkXzYgPSAvKiNfX1BVUkVfXyovX3dpdGhTY29wZUlkKGZ1bmN0aW9uICgpIHsKICByZXR1cm4gLyojX19QVVJFX18qL19jcmVhdGVFbGVtZW50Vk5vZGUoImRpdiIsIG51bGwsIG51bGwsIC0xKTsKfSk7CgpleHBvcnQgZnVuY3Rpb24gcmVuZGVyKF9jdHgsIF9jYWNoZSwgJHByb3BzLCAkc2V0dXAsICRkYXRhLCAkb3B0aW9ucykgewogIHZhciBfY3R4JGF3YXJkTGlzdCR2YWx1ZSQsIF9jdHgkYXdhcmRMaXN0JHZhbHVlOwoKICByZXR1cm4gX29wZW5CbG9jaygpLCBfY3JlYXRlRWxlbWVudEJsb2NrKCJkaXYiLCBfaG9pc3RlZF8xLCBbX2NyZWF0ZUVsZW1lbnRWTm9kZSgiZGl2IiwgbnVsbCwgW19jcmVhdGVFbGVtZW50Vk5vZGUoImRpdiIsIG51bGwsIF90b0Rpc3BsYXlTdHJpbmcoKChfY3R4JGF3YXJkTGlzdCR2YWx1ZSQgPSBfY3R4LmF3YXJkTGlzdC52YWx1ZVtfY3R4LmldKSA9PT0gbnVsbCB8fCBfY3R4JGF3YXJkTGlzdCR2YWx1ZSQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jdHgkYXdhcmRMaXN0JHZhbHVlJC5ncmFkZSkgfHwgIuS6lOetieWlliIpLCAxKSwgX2NyZWF0ZUVsZW1lbnRWTm9kZSgiZGl2IiwgbnVsbCwgW19jcmVhdGVFbGVtZW50Vk5vZGUoImltZyIsIHsKICAgIHN0eWxlOiB7CiAgICAgICJ3aWRodCI6ICIxMDAlIgogICAgfSwKICAgIHNyYzogcmVxdWlyZSgnJykKICB9LCBudWxsLCA4LCBfaG9pc3RlZF8yKV0pLCBfY3JlYXRlRWxlbWVudFZOb2RlKCJkaXYiLCBudWxsLCBbKF9vcGVuQmxvY2sodHJ1ZSksIF9jcmVhdGVFbGVtZW50QmxvY2soX0ZyYWdtZW50LCBudWxsLCBfcmVuZGVyTGlzdChfY3R4Lndvcmtlck5hbWUudmFsdWUsIGZ1bmN0aW9uIChpdGVtLCBpbmRleCkgewogICAgcmV0dXJuIF9vcGVuQmxvY2soKSwgX2NyZWF0ZUVsZW1lbnRCbG9jaygiZGl2IiwgewogICAgICBrZXk6IGluZGV4CiAgICB9LCBfdG9EaXNwbGF5U3RyaW5nKGl0ZW0ubmFtZSkgKyAiO+WRmOW3peWPt++8miIgKyBfdG9EaXNwbGF5U3RyaW5nKGl0ZW0udWlkKSwgMSk7CiAgfSksIDEyOCkpXSksIF9ob2lzdGVkXzNdKSwgX3dpdGhEaXJlY3RpdmVzKF9jcmVhdGVFbGVtZW50Vk5vZGUoImRpdiIsIF9ob2lzdGVkXzQsIG51bGwsIDUxMiksIFtbX3ZTaG93LCBfY3R4LnNob3dNb2RhbF1dKSwgX3dpdGhEaXJlY3RpdmVzKF9jcmVhdGVFbGVtZW50Vk5vZGUoImRpdiIsIF9ob2lzdGVkXzUsIG51bGwsIDUxMiksIFtbX3ZTaG93LCBfY3R4LnNob3dNb2RhbF1dKSwgX2hvaXN0ZWRfNiwgX2NyZWF0ZUVsZW1lbnRWTm9kZSgiYnV0dG9uIiwgewogICAgb25DbGljazogX2NhY2hlWzBdIHx8IChfY2FjaGVbMF0gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBfY3R4LnN0YXJ0TG90dGVyeSAmJiBfY3R4LnN0YXJ0TG90dGVyeS5hcHBseShfY3R4LCBhcmd1bWVudHMpOwogICAgfSkKICB9LCBfdG9EaXNwbGF5U3RyaW5nKF9jdHguYnV0dG9uTmFtZSksIDEpLCBfY3JlYXRlRWxlbWVudFZOb2RlKCJidXR0b24iLCB7CiAgICBvbkNsaWNrOiBfY2FjaGVbMV0gfHwgKF9jYWNoZVsxXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIF9jdHguZG93bmxvYWRFeGNlbCAmJiBfY3R4LmRvd25sb2FkRXhjZWwuYXBwbHkoX2N0eCwgYXJndW1lbnRzKTsKICAgIH0pCiAgfSwgIuS4i+i9vWV4Y2VsIiksIF9jdHguaSA8PSAwIHx8ICgoX2N0eCRhd2FyZExpc3QkdmFsdWUgPSBfY3R4LmF3YXJkTGlzdC52YWx1ZVtfY3R4LmF3YXJkTGlzdC5sZW5ndGggLSAxXSkgPT09IG51bGwgfHwgX2N0eCRhd2FyZExpc3QkdmFsdWUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jdHgkYXdhcmRMaXN0JHZhbHVlLm51bSkgIT09IDAgPyAoX29wZW5CbG9jaygpLCBfY3JlYXRlRWxlbWVudEJsb2NrKCJidXR0b24iLCB7CiAgICBrZXk6IDAsCiAgICBvbkNsaWNrOiBfY2FjaGVbMl0gfHwgKF9jYWNoZVsyXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIF9jdHguY2xlYW5Bd2FyZCAmJiBfY3R4LmNsZWFuQXdhcmQuYXBwbHkoX2N0eCwgYXJndW1lbnRzKTsKICAgIH0pCiAgfSwgIiDmuIXnqbrlpZbmsaAgIikpIDogX2NyZWF0ZUNvbW1lbnRWTm9kZSgiIiwgdHJ1ZSldKTsKfQ=="},{"version":3,"sources":["C:\\Users\\user\\lottery\\src\\components\\lottery.vue"],"names":[],"mappings":"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","sourcesContent":["<!--\n * @Author: your name\n * @Date: 2021-12-27 18:22:02\n * @LastEditTime: 2022-01-10 10:53:26\n * @LastEditors: Please set LastEditors\n * @Description: 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE\n * @FilePath: \\lottery\\src\\components\\HelloWorld.vue\n-->\n<template>\n  <div class=\"bg_page\">\n    <div>\n      <div>\n        {{ awardList.value[i]?.grade || \"五等奖\" }}\n      </div>\n      <div>\n        <!-- <div v-if=\"award\">抽中{{ award }}</div> -->\n        <img style=\"widht: 100%\" :src=\"require('')\" />\n      </div>\n      <div>\n        <div v-for=\"(item, index) in workerName.value\" :key=\"index\">\n          {{ item.name }};员工号：{{ item.uid }}\n        </div>\n      </div>\n\n      <img src=\"../assets/start.png\" />\n    </div>\n\n    <div class=\"modal\" v-show=\"showModal\"></div>\n    <div class=\"modal_bg\" v-show=\"showModal\"></div>\n    <!-- <div>\n      {{ awardList.value[i]?.grade }}等奖品：{{ awardList.value[i]?.name }}\n    </div> -->\n    <!-- <div v-for=\"(item, index) in workerName.value\" :key=\"index\">\n      姓名：{{ item.name }};员工号：{{ item.uid }}\n    </div> -->\n\n    <div></div>\n\n    <button @click=\"startLottery\">{{ buttonName }}</button>\n    <button @click=\"downloadExcel\">下载excel</button>\n    <button\n      @click=\"cleanAward\"\n      v-if=\"i <= 0 || awardList.value[awardList.length - 1]?.num !== 0\"\n    >\n      清空奖池\n    </button>\n  </div>\n</template>\n\n<script>\nimport { defineComponent, reactive, ref } from \"vue\";\nimport moment from \"moment\";\nimport Excel from \"exceljs/dist/exceljs\";\n\nlet db = null;\nexport default defineComponent({\n  setup() {\n    let showModal = ref(false);\n    let awardList = reactive({\n      value: [],\n    });\n    let gradeLists = reactive({\n      value: { 3: \"一\", 5: \"二\", 10: \"三\", 15: \"四\" },\n    });\n    let workerList = reactive({\n      value: [],\n    });\n    let workerName = reactive({ value: [] });\n    let award = ref(\"\");\n    let workerId = ref([]);\n    let i = ref(20);\n    let interval = reactive({ value: null });\n\n    let isStop = ref(true);\n    let lotteryList = reactive({\n      value: [],\n    });\n    let gradeList = ref([\"一\", \"二\", \"三\", \"四\", \"五\"]);\n    let getData = ({ tableName }) => {\n      lotteryList.value = [];\n      if (tableName === \"Awards\") {\n        return new Promise((resolve, reject) => {\n          let search = db\n            .transaction([tableName], \"readwrite\")\n            .objectStore(tableName);\n          let request = search.openCursor();\n          request.onerror = function () {\n            console.log(\"失败\");\n            reject();\n          };\n          request.onsuccess = function (e) {\n            var cursor = e.target.result;\n            console.log(\"成功\");\n            if (cursor) {\n              //console.log(cursor.value, 8888);\n              lotteryList.value.push(cursor.value);\n              cursor.continue();\n            } else {\n              if (lotteryList[i.value].num == 0) {\n                i.value = i.value + 1;\n              }\n              resolve();\n            }\n          };\n        });\n      }\n\n      // console.log(999);\n    };\n    function cleanAward() {\n      let store = db.transaction([\"Users\"], \"readwrite\").objectStore(\"Users\");\n      store.clear();\n      history.go(0);\n    }\n    async function downloadExcel() {\n      let a = [];\n      try {\n        const request = db\n          .transaction([\"Users\"], \"readwrite\")\n          .objectStore(\"Users\")\n          .openCursor();\n        request.onsuccess = function (e) {\n          let result = e.target.result;\n\n          if (result) {\n            a.push(result.value);\n            result.continue();\n          } else {\n            var jsonData = a;\n            //列标题，逗号隔开，每一个逗号就是隔开一个单元格\n            let str = `员工id,姓名,等级,奖项,时间\\n`;\n            //增加\\t为了不让表格显示科学计数法或者其他格式\n            for (let i = 0; i < jsonData.length; i++) {\n              for (let item in jsonData[i]) {\n                str += `${jsonData[i][item] + \"\\t\"},`;\n              }\n              str += \"\\n\";\n            }\n            //encodeURIComponent解决中文乱码\n            let uri =\n              \"data:text/xlsx;charset=utf-8,\\ufeff\" + encodeURIComponent(str);\n            //通过创建a标签实现\n            var link = document.createElement(\"a\");\n            link.href = uri;\n            //对下载的文件命名\n            link.download = \"2022年会中奖名单.xls\";\n            document.body.appendChild(link);\n            link.click();\n            document.body.removeChild(link);\n          }\n        };\n      } catch (error) {\n        console.log(error);\n      }\n    }\n\n    function writeDataBase({ tableName, id }) {\n      //奖池减一，人数获一\n      //获奖人不再参与下次抽奖？\n      let stores = db\n        .transaction([tableName], \"readwrite\")\n        .objectStore(tableName);\n      let request = stores.put({ id });\n      request.onsuccess = function (e) {\n        console.log(e);\n      };\n    }\n    function startLottery() {\n      // workerList.value = workerList.value.filter((item) => item.num === 0);\n      //let length = [...workerList.value].length;\n      //console.log(88800, aR.value.get(1));\n      let stopLottery = () => {\n        if (interval.value) {\n          //写操作\n          //员工id员工num\n          //奖品id奖品num\n          //是否进行下一等级抽奖\n\n          clearInterval(interval.value);\n          let saveData = (ind) => {\n            try {\n              let bR = null;\n              if (!bR) {\n                bR = db\n                  .transaction([\"Users\"], \"readwrite\")\n                  .objectStore(\"Users\");\n              }\n\n              bR.add({\n                id: workerName.value[ind].id,\n                name: workerName.value[ind].name,\n                grade: awardList.value[i.value].grade,\n                award: awardList.value[i.value].name,\n                time: moment().format(\"YYYY-MM-DD HH:mm:ss\"),\n                img: awardList.value[i.value].img,\n              });\n            } catch (error) {\n              console.log(888, error);\n            }\n          };\n          if (i.value >= 13) {\n            saveData(0);\n            saveData(1);\n          } else {\n            saveData(0);\n          }\n          workerList.value = workerList.value.filter((item) => {\n            if (i.value >= 13) {\n              return (\n                workerName.value[0].id !== item.id &&\n                workerName.value[1].id !== item.id\n              );\n            } else {\n              return workerName.value[0].id !== item.id;\n            }\n          });\n\n          i.value >= 0 && (award.value = awardList.value[i.value].name);\n\n          //console.log(22, workerList.value);\n          //let a = [...workerList.value];\n\n          // console.log(22, workerList.value);\n          //writeDataBase()\n\n          interval.value = null;\n        }\n      };\n      isStop.value = !isStop.value;\n      if (i.value == 0) {\n        if (interval.value) {\n          stopLottery();\n          clearInterval(interval.value);\n        }\n\n        return;\n      }\n      //   awardList.forEach((item) => {\n      //     if(){}\n      //   });\n\n      let index = 0;\n      // awardList.forEach(item=>{\n\n      // })\n      console.log(888888, isStop.value, i.value);\n      if (!isStop.value) {\n        if (awardList.value[awardList.value.length - 1]?.num == 0) {\n          if (i.value > 0) {\n            i.value = i.value - 1;\n          } else {\n            i.value = 0;\n          }\n        }\n        if (awardList.value[i.value].num > 0) {\n          awardList.value[i.value].num = 0;\n        }\n\n        award.value = \"\";\n        // if (i.value < 0) {\n        // }\n        //读操作\n        //员工表\n        //await getData({ tableName: \"Awards\" });\n        interval.value = setInterval(() => {\n          if (index < workerList.value.length) {\n            if (i.value >= 13) {\n              workerName.value = [\n                {\n                  name: workerList.value[index].name,\n                  id: workerList.value[index].id,\n                  uid: workerList.value[index].uid,\n                },\n                {\n                  name: workerList.value[\n                    index < workerList.value.length - 1 ? index + 1 : 0\n                  ].name,\n                  id: workerList.value[\n                    index < workerList.value.length - 1 ? index + 1 : 0\n                  ].id,\n                  uid: workerList.value[\n                    index < workerList.value.length - 1 ? index + 1 : 0\n                  ].uid,\n                },\n              ];\n            } else {\n              workerName.value = [\n                {\n                  name: workerList.value[index].name,\n                  id: workerList.value[index].id,\n                  uid: workerList.value[index].uid,\n                },\n              ];\n\n              //workerId.value = [workerList.value[index].id];\n            }\n\n            index++;\n          } else {\n            index = 0;\n          }\n        }, 100);\n        //   timeout = setTimeout(() => {\n\n        //     console.log(89000);\n        //   }, Infinity);\n      }\n      if (isStop.value) {\n        //写入\n        stopLottery();\n      }\n    }\n    const request = indexedDB.open(\"user\", 10);\n    request.onerror = function (e) {\n      // 错误处理\n      console.log(\" 打开数据库报错\", e);\n    };\n\n    request.onupgradeneeded = function (e) {\n      console.log(99999999999999);\n      e.target.result && (db = e.target.result);\n      //db = e.target.result;\n      if (!db.objectStoreNames.contains(\"Users\")) {\n        var a = db.createObjectStore(\"Users\", {\n          keyPath: \"id\",\n        });\n        a.createIndex(\"name\", \"name\", {\n          unique: false,\n        });\n      }\n\n      //   if (!db.objectStoreNames.contains(\"Users\")) {\n\n      //   }\n      if (!db.objectStoreNames.contains(\"Awards\")) {\n        var d = db.createObjectStore(\"Awards\", {\n          keyPath: \"id\",\n        });\n        d.createIndex(\"name\", \"name\", {\n          unique: false,\n        });\n      }\n    };\n    request.onsuccess = function (e) {\n      e.target.result && (db = e.target.result);\n      // var obj1 = { hello: \"world\" };\n      //var blob = new Blob([JSON.stringify(obj1, null, 2)], {\n      //  type: \"application/json\",\n      // });\n\n      let aR = db.transaction([\"Awards\"], \"readwrite\").objectStore(\"Awards\");\n      [\n        { name: \"iphone12\", num: 1 },\n        { name: \"小米电视\", num: 3 },\n        { name: \"不沾锅\", num: 5 },\n        { name: \"电吹风\", num: 8 },\n        { name: \"日记本\", num: 12 },\n      ].forEach((element, index) => {\n        aR.add({\n          id: index + 1,\n          name: element.name,\n          image: \"XXX\",\n          num: element.num,\n        });\n      });\n\n      //   aR.addEventListener(\"success\", (e) => {\n      //     console.log(12333, e);\n      //   });\n    };\n    //查询\n\n    return {\n      awardList,\n      lotteryList,\n      startLottery,\n      gradeLists,\n      isStop,\n      workerList,\n      workerName,\n      award,\n      i,\n      interval,\n      workerId,\n      gradeList,\n      getData,\n      writeDataBase,\n      downloadExcel,\n      cleanAward,\n      showModal,\n    };\n\n    // var a = window.openDatabase(\"mydb\", \"1.0\", \"Test DB\", 2 * 1024 * 1024);\n    // console.log(9900, a);\n  },\n\n  computed: {\n    buttonName() {\n      if (this.i == 0) {\n        return !this.isStop ? \"停止抽一等奖 \" : \"本次抽奖已结束\";\n      } else {\n        return this.isStop\n          ? `开始抽${\n              this.awardList.value[this.i]?.nextGrade ||\n              this.awardList.value[this.i]?.grade\n            }等奖`\n          : \"停止抽奖\";\n      }\n    },\n    awardImg() {\n      console.log(123456, this.awardList.value[this.i]?.img);\n      if (this.awardList.value.length > 0 && this.awardList.value[this.i].img) {\n        return require(this.awardList.value[this.i].img);\n      }\n      return \"\";\n    },\n  },\n  mounted() {\n    // console.log(workbook);\n\n    // const d = await workbook.xlsx.load(require(\"../assets/name_list.xlsx\"));\n    //console.log(8899, d);\n    //workbook.xlsx.readFile(\"../assets/name_list.xlsx\");\n    // const response = await fetch(\"./name_list.xlsx\");\n    // const buffer = await response.arrayBuffer();\n    // const options = {\n    //   sharedStrings: \"emit\",\n    //   hyperlinks: \"emit\",\n    //   worksheets: \"emit\",\n    // };\n    let workerList = [];\n    const workbook = new Excel.Workbook();\n    const setWorkerList = (aList) => {\n      this.workerList.value = aList;\n    };\n\n    const setAwardList = (aList) => {\n      console.log(888, aList);\n      this.awardList.value = aList;\n    };\n    let gradeLists = this.gradeLists.value;\n    // const workbook = ExcelJS.stream.xlsx.WorkbookReader(\n    //   \"./namelist.xlsx\",\n    //   options\n    // );\n    //workbook.read();\n    fetch(\"./namelist.xlsx\", {\n      responseType: \"arrayBuffer\",\n    })\n      .then((res) => {\n        return res.arrayBuffer();\n      })\n      .then(async (buffer) => {\n        workbook.xlsx.load(buffer).then(async (d) => {\n          const worksheet = d.getWorksheet(1);\n          //const a = await worksheet.parse();\n          worksheet.eachRow(function (row, rowNumber) {\n            if (rowNumber > 1) {\n              workerList.push({\n                id: rowNumber,\n                uid: row.values[2],\n                name: row.values[3],\n                num: 0,\n              });\n            }\n\n            // console.log(\n            //   \"Row \" + rowNumber + \" = \" + JSON.stringify(row.values)\n            // );\n          });\n        });\n        setWorkerList(workerList);\n      });\n    let awardList = [];\n    fetch(\"./award_list.xlsx\", {\n      responseType: \"arrayBuffer\",\n    })\n      .then((res) => {\n        return res.arrayBuffer();\n      })\n      .then(async (buffer) => {\n        workbook.xlsx.load(buffer).then(async (d) => {\n          const worksheet = d.getWorksheet(1);\n          //const a = await worksheet.parse();\n          worksheet.eachRow(function (row, rowNumber) {\n            console.log(123, row.values[5]);\n            if (rowNumber > 1) {\n              gradeLists[rowNumber]\n                ? awardList.push({\n                    name: row.values[3],\n                    num: row.values[4],\n                    grade: row.values[2],\n                    nextGrade: gradeLists[rowNumber],\n                    img: row.values[5],\n                  })\n                : awardList.push({\n                    name: row.values[3],\n                    num: row.values[4],\n                    grade: row.values[2],\n                    img: row.values[5],\n                  });\n            }\n            // awardList.push({\n            //   id: rowNumber,\n            //   uid: row.values[2],\n            //   name: row.values[3],\n            //   num: 0,\n            // });\n            // console.log(\n            //   \"Row \" + rowNumber + \" = \" + JSON.stringify(row.values)\n            // );\n          });\n          setAwardList(awardList);\n        });\n        setAwardList(workerList);\n      });\n  },\n});\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style lang=\"less\" scoped>\nh3 {\n  margin: 40px 0 0;\n}\nul {\n  list-style-type: none;\n  padding: 0;\n}\nli {\n  display: inline-block;\n  margin: 0 10px;\n}\na {\n  color: #42b983;\n}\n.modal_bg {\n  background-image: url(\"../assets/lotterry_modal.png\");\n  background-repeat: no-repeat;\n  height: 33.3vw;\n  position: fixed;\n  z-index: 1000;\n  width: 33.3vw;\n  background-size: 100% 100%;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n}\n.modal {\n  position: fixed;\n  top: 0;\n  z-index: 500;\n  width: 100vw;\n  height: 100vh;\n  background-color: rgba(0, 0, 0, 0.8);\n}\n.bg_page {\n  top: 0;\n  margin: 0;\n  padding: 0;\n  background-image: url(\"../assets/BG.png\");\n  background-size: 100% 100%;\n  height: 100vh;\n  width: 100vw;\n  overflow: hidden;\n  display: block;\n  clear: both;\n  & > :nth-child(1) {\n    position: absolute;\n    left: 50%;\n    transform: translateX(-50%);\n    bottom: 0;\n    & > :nth-child(2) {\n      width: 20vw;\n      height: 20vw;\n      margin: 0 auto;\n      background-image: url(\"../assets/award_area.png\");\n      background-size: 100% 100%;\n      display: flex;\n    }\n    & > :nth-child(3) {\n      background-image: url(\"../assets/name_BG.png\");\n      line-height: 2.5vw;\n      margin-bottom: 1.5vw;\n      margin-top: 0.8vw;\n      height: 2.5vw;\n    }\n    & > :nth-child(4) {\n      width: 35vw;\n      display: block;\n      line-height: 0;\n    }\n  }\n}\n</style>\n"],"sourceRoot":""}]}